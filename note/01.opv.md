## gh - preparse vars

```powershell
cd D:\code\rust\envedit


$repo="ymc-github/envedit"
$repo_desc="get/set os environment variables in rust"

$repo_uname=$repo -replace "-","_" -replace "/","_";
$repo_name=$repo  -replace ".*/","";
$repo_user=$repo  -replace "/.*","";

$email=git config user.email;

$repo_user;
$repo_name;
```

## pj - prepare vars

```powershell
$proj_name="envedit";
$code_root="D:/code/rust";
$proj_path="$code_root/$proj_name";
```

## pj - clone repo from remote repo

```powershell
# make dirs
mkdir -p $code_root;

# cd $code_root;

# download code
degit g-plane/pnpm-docker $proj_path

code $proj_path

```

## copy repo from local repo

```powershell
$shcode="cp -r D:/code/rust/pico $proj_path"; ;sh -c "$shcode";

yours edit-toml --file Cargo.toml --name "name" --value "$proj_name" --ns "package";
yours edit-toml --file Cargo.toml --name "description" --value "$repo_desc" --ns "package";
yours edit-toml --file Cargo.toml --name "repository" --value "$repo/ymc-github/editenv" --ns "package";
yours edit-toml --file Cargo.toml --name "authors[0]" --value "Ye MianCheng" --ns "package"

code $proj_path
```

## read size of exe files

```powershell
# envedit vs editenv
$appname="envedit";$appversion="1.0.0";

# get exe app size of bytes
$shcode="du -sb target/release/${appname}.exe | awk '{print `$1}'";sh -c "$shcode" # 7431680



# 7.1M -> 3.1M -> 2.8M
# get exe app size of human-readable - exe -X64 xx.exe
$file="target/release/${appname}.exe";$shcode="ls -lh $file | awk '{print  `$5}'";sh -c "$shcode" # 7.1M
```

## get/set window os env in rust

```powershell
cargo run --help # dev
cargo build --release # build for release
# cargo clean
# target/release/pico.exe

cargo run -- get cuda_path
cargo run -- set cuda_path "F:\scoop\apps\cuda\current"

cargo run -- get OLLAMA_MODELS
cargo run -- set OLLAMA_MODELS "G:\data\LLM"
cargo run -- set OLLAMA_MODELS "G:\data\ollama\LLM"
```

## get/set window os env in cli

```powershell
& "target/release/${appname}.exe" get OLLAMA_MODELS
& "target/release/${appname}.exe" set OLLAMA_MODELS "G:\data\ollama\LLM"
```

## gh -gh - login with token from file

```powershell
# gh auth login --with-token < mytoken.txt
$token=get-content d:/book/secret/github.token.md;
# $token

# gh auth login --with-token $token # fail in powershell

# gh login with token from file in powershell
get-content d:/book/secret/github.token.md | gh auth login --with-token

# sh -c 'gh auth login --with-token < d:/book/secret/github.token.md'

# gh issue list --label "bug" --label "help wanted"
```

## gh -gh - add github repo

```powershell
# create public repo
gh repo create $repo_name --public --description "$repo_desc"
# create private repo

gh repo create $repo_name --private --description "$repo_desc"
```

## gh -create deploy token

```powershell
# $repo="ymc-github/yours"

# list repo for some repo
gh repo deploy-key list --repo $repo

# std repo name and get email from git
# $repo_uname=$repo -replace "-","_" -replace "/","_";$email=git config user.email;

# mkdir -p ~/.ssh/;

# ssh-keygen -C "$email" -f ~/.ssh/gh_$repo_uname -t ed25519 -N "123" #done

ssh-keygen -C "$email" -f $HOME/.ssh/gh_$repo_uname -t ed25519 -N '""' #done

```

[ssh-keygen-in-windows-powershell-create-a-key-pair-and-avoid-pr](https://superuser.com/questions/1634427/non-interactive-ssh-keygen-in-windows-powershell-create-a-key-pair-and-avoid-pr)

## gh - upload github deploy

```powershell
# gh repo deploy-key list --repo $repo;
gh repo deploy-key add $HOME/.ssh/gh_${repo_uname}.pub --repo $repo -w --title deploy;
```

## add secret to github

```powershell

gh secret set --repo $repo  -f D:\book\secret\gh.token.auto.md
```

## gh -set ssh key client

```powershell
# cmd format:
# cmd_ns cmd_api:cmd_method cmd_opts
# ymch gh/use $repo # todo - set current using repo for github. through setting GH_REPO_USING in os environment variables.
# ymch gh/ssh-key/use # todo - set ssh key for github repo using GH_REPO_USING in os environment variables.

# --repo-format "{user_name}/{repo_name}"
# --ssh-key-cnf-tpl
$txt=@"
Host github.com
    User git
    HostName github.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/gh_${repo_uname}
"@

set-content -path $HOME/.ssh/config -value $txt
ssh -T git@github.com
# ssh -Tv git@github.com
```

## gh -push to github ghg with git

```powershell
# git remote -v
# git remote remove ghg
git remote add ghg git@github.com:$repo.git
git push -u ghg main
git push ghg main
```

```powershell
git add .;git commit -m "docs(core): init";
git add d:/book/secret/.gitignore; git commit -m "build(core): ignore token in secret"

```

```powershell
git log --oneline
```

## gr - init

```powershell
del -recurse -force .git;git init;


git add . ; git commit -m "build(core): init"

git add . ; git commit -m "feat(core): add icon to set program file icon"

git add . ; git commit -m "build(core): set release workflow in github"

git add . ; git commit -m "docs(core): set repo description"

git add . ; git commit -m "build(core): put app name and repo name"

git add . ; git commit -m "docs(core): put deps description"

git add . ; git commit -m "docs(core): put app name"
git add . ; git commit -m "docs(core): download using scoop"

git add . ; git commit -m "build(core): use cross platform note"
```

## copy release workflow from local other repo

```powershell
yours cp --src ../pico/.github/workflows/release.yml --des .github/workflows/release.yml

yours edit-docs --tpl-file .github/workflows/release.yml --out-file .github/workflows/release.yml --data "editenv" --label "pico"

```

## tag

```powershell
# git log --oneline

$ver="1.0.0";
$ver="1.0.1";$tagdesc="put package home page";
git tag $ver HEAD

# git tag -a $ver -m "version $ver"

# push one tag to remote ghg
git push ghg $ver

# push all tag to remote ghg
# git push ghg --tags

# git push ghg main

# del tag
git tag -d $ver
# del remote tag
git push ghg :refs/tags/$ver


# git HEAD / HEAD^ / HEAD~
# HEAD = HEAD~0 = HEAD^0

# git tag $ver HEAD
git tag $ver HEAD^1

git tag -a $ver -m "version $ver, tag info"



# del
git tag -d $ver;git push ghg :refs/tags/$ver

# del release
gh release delete $ver --repo $repo --yes

# add
git tag $ver HEAD -m "version $ver";

# git tag $ver HEAD -m "version $ver - $tagdesc";git push ghg main ; git push ghg $ver

# push to github
git tag $ver HEAD -m "version $ver";git push ghg main ; git push ghg $ver

# list workflow
gh workflow list --repo $repo
# info workflow status
gh workflow view release  --repo $repo
# gh run list --workflow deploy.yml  --repo $repo

#  gh workflow view deploy.yml --yaml
```
